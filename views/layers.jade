doctype html
html
    head
        title OpenLayers Map
        link(rel='stylesheet' href='https://openlayers.org/en/v4.6.5/css/ol.css')
    body
        div
            label(for='layerSelector') Select Layer:
            select#layerSelector
                // The options will be populated dynamically using JavaScript
        #map(style='width: 100%; height: 500px;')
        script(src='https://openlayers.org/en/v4.6.5/build/ol.js')
        script.
            var geoJSONDataUrl = 'assets/layers/capas_js/0.json';
            var map;
            var centerCoordinates = [-104.336608, 19.10707];

            // Create the base map on load page
            document.addEventListener('DOMContentLoaded', function () {
                map = new ol.Map({
                    target: 'map',
                    layers: [
                        new ol.layer.Tile({
                            source: new ol.source.OSM()
                        }),
                        new ol.layer.Vector({
                            source: new ol.source.Vector({
                                url: geoJSONDataUrl,
                                format: new ol.format.GeoJSON()
                            })
                        })
                    ],
                    view: new ol.View({
                        center: ol.proj.fromLonLat(centerCoordinates),
                        zoom: 12
                    })
                });
            });

            layerSelector.addEventListener('change', function () {
                var selectedLayer = this.value;
                updateMap(selectedLayer);
            });

            // Function to update the map layer with the selected layer
            function updateMap(selectedLayer) {
                geoJSONDataUrl = 'assets/layers/capas_js/' + selectedLayer;
                var vectorSource = new ol.source.Vector({
                    url: geoJSONDataUrl,
                    format: new ol.format.GeoJSON()
                });
                // See the data inside the GeoJSON file
                fetch('/' + geoJSONDataUrl)
                    .then((response) => response.json())
                    .then((data) => {
                        console.log(data);
                    })
                    .catch((error) => {
                        console.error('Error fetching GeoJSON data:', error);
                    });

                // Update the existing vector layer's source
                map.getLayers().item(1).setSource(vectorSource);
            }

            fetch('/api/v1/layers/all')
                .then((response) => response.json())
                .then((layers) => {
                    // Set the list of layers in #layerSelector
                    layers.forEach(function (layer) {
                        var option = document.createElement('option');
                        option.value = layer.name;
                        option.text = layer.name;
                        document.getElementById('layerSelector').appendChild(option);
                    });
                })
                .catch((error) => {
                    console.error('Error fetching layers:', error);
                });
